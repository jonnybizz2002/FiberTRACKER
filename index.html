<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Frontier Fiber Sales Tracker</title>

<style>
body { font-family: Arial,sans-serif; background:#f4f6f8; padding:15px; margin:0; }
h1 { text-align:center; color:#007bff; }
.stats { background:white; padding:12px; border-radius:8px; margin-bottom:15px; text-align:center; font-weight:bold; }
form { background:white; padding:15px; border-radius:8px; margin-bottom:20px; }
label { font-weight:bold; display:block; margin-top:10px; }
input, select, button { width:100%; padding:10px; margin-top:5px; font-size:16px; }
.checkbox-row { margin-top:6px; }
button { border:none; border-radius:5px; margin-top:10px; color:white; cursor:pointer; }
.add-btn { background:#007bff; }
.export-btn { background:#28a745; }
.filter-bar { display:flex; gap:5px; margin-bottom:10px; }
.filter-bar button { flex:1; font-size:14px; }
.install-group { margin-bottom:25px; }
.install-header { background:#343a40; color:white; padding:8px; border-radius:5px; font-weight:bold; }
table { width:100%; border-collapse:collapse; background:white; }
th, td { border:1px solid #ccc; padding:6px; font-size:13px; text-align:center; }
th { background:#007bff; color:white; }
.status-pending { background:#fff3cd; }
.status-installed { background:#d4edda; }
.status-canceled { background:#f8d7da; }
.status-btn, .delete-btn, .confirm-btn {
  width:100%; padding:6px; font-size:12px; border:none; border-radius:4px; cursor:pointer;
}
.pending-btn { background:#ffc107; }
.installed-btn { background:#28a745; color:white; }
.canceled-btn { background:#dc3545; color:white; }
.confirm-btn { background:#17a2b8; color:white; }
.delete-btn { background:#6c757d; color:white; }
td[contenteditable] { background:#eef6ff; }
</style>
</head>

<body>

<h1>Frontier Fiber Sales</h1>
<div class="stats" id="stats"></div>

<form id="saleForm">
  <label>Customer Name</label>
  <input id="name">

  <label>Phone</label>
  <input id="phone">

  <label>BTN</label>
  <input id="btn">

  <label>Speed</label>
  <select id="speed">
    <option value="">Select</option>
    <option>500 Mbps</option>
    <option>1 Gig</option>
    <option>2 Gig</option>
    <option>5 Gig</option>
  </select>

  <label>Attachments</label>
  <div class="checkbox-row"><input type="checkbox" id="wholeHome"> Whole Home</div>
  <div class="checkbox-row"><input type="checkbox" id="wifiSecurity"> WiFi Security</div>
  <div class="checkbox-row"><input type="checkbox" id="autopay"> AutoPay</div>
  <div class="checkbox-row"><input type="checkbox" id="confirmed"> Confirmed Order</div>

  <label>Date Sold</label>
  <input type="date" id="dateSold">

  <label>Install Date</label>
  <input type="date" id="installDate">

  <button type="button" id="addSaleBtn" class="add-btn">Add Sale</button>
</form>

<div class="filter-bar">
  <button id="filterAll">All</button>
  <button id="filterPending">Pending</button>
  <button id="filterInstalled">Installed</button>
  <button id="filterCanceled">Canceled</button>
</div>

<button class="export-btn" id="exportCSV">Export CSV</button>
<div id="groups"></div>
<button id="resetTracker" style="background:#dc3545;">Reset Tracker</button>

<script>
window.addEventListener("DOMContentLoaded", () => {

let sales = JSON.parse(localStorage.getItem("sales")) || [];
let filter = "All";

const statsDiv = document.getElementById("stats");
const groupsDiv = document.getElementById("groups");
const save = () => localStorage.setItem("sales", JSON.stringify(sales));

const formatDate = d => {
  if(!d) return "";
  const p = d.split("-");
  return `${p[1]}/${p[2]}/${p[0].slice(-2)}`;
};

function updateStats(){
  const t = sales.length;
  const i = sales.filter(s=>s.status==="Installed").length;
  const c = sales.filter(s=>s.status==="Canceled").length;
  const conf = sales.filter(s=>s.confirmed).length;
  statsDiv.innerHTML = `Total: ${t} | Installed: ${i} | Canceled: ${c} | Confirmed: ${conf}`;
}

function render(){
  updateStats();
  groupsDiv.innerHTML = "";
  const grouped = {};

  sales.forEach((s,i)=>{
    if(filter!=="All" && s.status!==filter) return;
    const k = formatDate(s.installDate) || "No Install Date";
    grouped[k] ??= [];
    grouped[k].push({s,i});
  });

  Object.keys(grouped).sort().forEach(date=>{
    const div = document.createElement("div");
    div.className = "install-group";
    div.innerHTML = `
      <div class="install-header">Install Date: ${date}</div>
      <table>
        <thead>
          <tr>
            <th>Name</th><th>Phone</th><th>BTN</th><th>Speed</th>
            <th>Attachments</th><th>Confirmed</th>
            <th>Date Sold</th><th>Status</th><th>Delete</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>`;
    const tbody = div.querySelector("tbody");

    grouped[date].forEach(({s,i})=>{
      const tr = document.createElement("tr");
      tr.className = s.status==="Installed"?"status-installed":
                     s.status==="Canceled"?"status-canceled":"status-pending";

      tr.innerHTML = `
        <td contenteditable>${s.name}</td>
        <td contenteditable>${s.phone}</td>
        <td contenteditable>${s.btn}</td>
        <td contenteditable>${s.speed}</td>
        <td contenteditable>${s.attachments}</td>
        <td><button class="confirm-btn">${s.confirmed ? "✅" : "❌"}</button></td>
        <td>${formatDate(s.dateSold)}</td>
        <td><button class="status-btn">${s.status}</button></td>
        <td><button class="delete-btn">X</button></td>`;

      const fields = ["name","phone","btn","speed","attachments"];
      tr.querySelectorAll("[contenteditable]").forEach((td,x)=>{
        td.addEventListener("input",()=>{
          sales[i][fields[x]] = td.innerText;
          save();
        });
      });

      tr.querySelector(".confirm-btn").onclick = ()=>{
        s.confirmed = !s.confirmed;
        save(); render();
      };

      tr.querySelector(".status-btn").onclick = ()=>{
        const order = ["Pending","Installed","Canceled"];
        s.status = order[(order.indexOf(s.status)+1)%3];
        save(); render();
      };

      tr.querySelector(".delete-btn").onclick = ()=>{
        sales.splice(i,1); save(); render();
      };

      tbody.appendChild(tr);
    });

    groupsDiv.appendChild(div);
  });
}

addSaleBtn.onclick = ()=>{
  if(!name.value.trim()) return alert("Name required");

  sales.push({
    name: name.value.trim(),
    phone: phone.value,
    btn: btn.value,
    speed: speed.value,
    confirmed: confirmed.checked,
    attachments: [
      wholeHome.checked?"Whole Home":"",
      wifiSecurity.checked?"WiFi Security":"",
      autopay.checked?"AutoPay":""
    ].filter(Boolean).join(", "),
    dateSold: dateSold.value,
    installDate: installDate.value,
    status:"Pending"
  });

  save(); render(); saleForm.reset();
};

filterAll.onclick = ()=>{filter="All"; render();};
filterPending.onclick = ()=>{filter="Pending"; render();};
filterInstalled.onclick = ()=>{filter="Installed"; render();};
filterCanceled.onclick = ()=>{filter="Canceled"; render();};

exportCSV.onclick = ()=>{
  let csv = "Name,Phone,BTN,Speed,Attachments,Confirmed,Date Sold,Install Date,Status\n";
  sales.forEach(s=>{
    csv+=`"${s.name}","${s.phone}","${s.btn}","${s.speed}","${s.attachments}","${s.confirmed}","${formatDate(s.dateSold)}","${formatDate(s.installDate)}","${s.status}"\n`;
  });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(new Blob([csv],{type:"text/csv"}));
  a.download = "frontier_sales.csv";
  a.click();
};

resetTracker.onclick = ()=>{
  if(confirm("Delete all sales?")){
    sales=[]; localStorage.clear(); render();
  }
};

render();
});
</script>
</body>
</html>
